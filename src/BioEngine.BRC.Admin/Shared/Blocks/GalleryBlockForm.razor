@using BioEngine.BRC.Common.Entities.Blocks
@using BioEngine.BRC.Common
@using Sitko.Core.Storage
@using StorageItem = BioEngine.BRC.Common.Entities.StorageItem
@using System.IO
@inject IStorage<BRCStorageConfig> Storage

<InputFile accept="image/*" multiple OnChange="HandleSelection"/>
@if (Block.Data.Pictures.Length > 0)
{
    foreach (var picture in Block.Data.Pictures)
    {
        <img src="@Storage.PublicUri(picture)" alt="@picture.FileName"/>
    }
}

@code
{
    [Parameter]
    public GalleryBlock Block { get; set; }

    private int Progress { get; set; }
    private string Info { get; set; }

    async Task HandleSelection(IFileListEntry[] files)
    {
        var pictures = new List<StorageItem>();
        foreach (var file in files)
        {
            await using var stream = new MemoryStream();
            await file.Data.CopyToAsync(stream);
            pictures.Add(StorageItem.FromCore(await Storage.SaveFileAsync(stream, file.Name, "posts")));
        }
        Block.Data.Pictures = pictures.ToArray();
    }
}
