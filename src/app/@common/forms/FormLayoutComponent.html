<nb-card>
  <nb-card-header>{{FormComponent.Title}}</nb-card-header>
  <nb-card-body>
    <form class="form-horizontal" [formGroup]="FormComponent.formGroup" *ngIf="FormComponent.formLoaded">
      <nb-tabset>
        <nb-tab tabTitle="Основное">
          <!--<div *ngIf="!FormComponent.formGroup.valid">
            Form is invalid
            <div *ngFor="let key of ObjectKeys(FormComponent.formGroup.controls)">
              <div>
                {{key}}
                <errorsList [Control]="FormComponent.formGroup.controls[key]"></errorsList>
              </div>
            </div>
          </div>-->
          <ng-content></ng-content>
        </nb-tab>
        <nb-tab *ngFor="let propertiesSet
         of FormComponent.ModelProperties" [tabTitle]="propertiesSet.Name">
          <div *ngFor="let prop of propertiesSet.Properties">
            <div [ngSwitch]="prop.Type">
              <div *ngSwitchCase="FormComponent.PropertiesElementTypes.Dropdown">
                <drop-down-input [FormGroup]="FormComponent.formGroup" FieldName="{{propertiesSet.Key+prop.Key}}"
                                 [Options]="FormComponent.PropertiesOptions(propertiesSet.Key, prop.Key)"
                                 DisplayField="Title" GroupByField="Group" ValueField="Value"
                                 Label="{{prop.Name}}"></drop-down-input>
              </div>
              <div *ngSwitchCase="FormComponent.PropertiesElementTypes.String">
                <text-input [FormGroup]="FormComponent.formGroup" FieldName="{{propertiesSet.Key+prop.Key}}"
                            Label="{{prop.Name}}"></text-input>
              </div>
              <div *ngSwitchCase="FormComponent.PropertiesElementTypes.PasswordString">
                <text-input [FormGroup]="FormComponent.formGroup" Type="password"
                            FieldName="{{propertiesSet.Key+prop.Key}}"
                            Label="{{prop.Name}}"></text-input>
              </div>
              <div *ngSwitchCase="FormComponent.PropertiesElementTypes.LongString">
                <textarea-input [FormGroup]="FormComponent.formGroup" FieldName="{{propertiesSet.Key+prop.Key}}"
                                Label="{{prop.Name}}"></textarea-input>
              </div>
              <div *ngSwitchCase="FormComponent.PropertiesElementTypes.Url">
                <text-input [FormGroup]="FormComponent.formGroup" Type="url"
                            FieldName="{{propertiesSet.Key+prop.Key}}"
                            Label="{{prop.Name}}"></text-input>
              </div>
              <div *ngSwitchCase="FormComponent.PropertiesElementTypes.Checkbox">
                <checkbox-input [FormGroup]="FormComponent.formGroup" FieldName="{{propertiesSet.Key+prop.Key}}"
                                Label="{{prop.Name}}"></checkbox-input>
              </div>
              <div *ngSwitchDefault>Unknown field</div>
            </div>
          </div>
        </nb-tab>
        <nb-tab tabTitle="<>">
          <pre>
          {{FormComponent.model|json}}
            </pre>
        </nb-tab>
      </nb-tabset>
      <button class="btn btn-primary" type="submit" (click)="save()"
              [ngClass]="{'invalid': FormComponent.formGroup.invalid, 'no-changes':!FormComponent.hasChanges}"
              [disabled]="FormComponent.formGroup.invalid||!FormComponent.hasChanges||FormComponent.inProgress">
        Сохранить
      </button>

      <button class="btn btn-success" (click)="FormComponent.changePublishState()"
              *ngIf="!FormComponent.model.IsPublished"
              [disabled]="FormComponent.formGroup.invalid||FormComponent.hasChanges||FormComponent.inProgress"
      >
        Опубликовать
      </button>

      <button class="btn btn-warning" (click)="FormComponent.changePublishState()"
              *ngIf="FormComponent.model.IsPublished"
              [disabled]="FormComponent.formGroup.invalid||FormComponent.hasChanges||FormComponent.inProgress"
      >
        Спрятать
      </button>
    </form>
  </nb-card-body>
</nb-card>
