<div style="position: relative;" class="mat-elevation-z8">
    <div class="loading-shade" *ngIf="!provider.dataLoaded">
        <mat-spinner></mat-spinner>
    </div>
    <mat-table [dataSource]="provider.items" matSort>
        <ng-container *ngFor="let column of provider.columns" matColumnDef="{{ column.Key }}">
            <mat-header-cell *matHeaderCellDef mat-sort-header [disabled]="!column.Sortable">
                {{ column.Title }}</mat-header-cell
            >
            <mat-cell
                *matCellDef="let row"
                [ngClass]="{ actions: column.Type == columnTypes.Actions }"
            >
                <ng-container ngSwitch="{{ column.Type }}">
                    <ng-container *ngSwitchCase="columnTypes.Text"
                        >{{ column.getValue(row) }}
                    </ng-container>
                    <ng-container *ngSwitchCase="columnTypes.Link">
                        <a [routerLink]="column.getLink(row)" [class.disabled]="column.Disabled">{{
                            column.getValue(row)
                        }}</a>
                    </ng-container>
                    <ng-container *ngSwitchCase="columnTypes.ActionLink">
                        <a
                            href="javascript:"
                            (click)="column.Click(row)"
                            [class.disabled]="column.Disabled"
                            >{{ column.getValue(row) }}</a
                        >
                    </ng-container>
                    <ng-container *ngSwitchCase="columnTypes.TimeAgo">
                        <span
                            title="{{
                                column.getValue(row)
                                    | amLocal
                                    | amDateFormat: 'DD MMMM YYYY, HH:mm:ss'
                            }}"
                            >{{ column.getValue(row) | amTimeAgo }}</span
                        >
                    </ng-container>
                    <ng-container *ngSwitchCase="columnTypes.SitesList">
                        <mat-chip-list>
                            <mat-chip selected *ngFor="let siteId of column.getValue(row)">
                                {{ column.Sites[siteId].Title }}
                            </mat-chip>
                        </mat-chip-list>
                    </ng-container>
                    <ng-container *ngSwitchCase="columnTypes.Site">
                        <mat-chip-list>
                            <mat-chip selected>
                                {{ column.Sites[column.getValue(row)].Title }}
                            </mat-chip>
                        </mat-chip-list>
                    </ng-container>
                    <ng-container *ngSwitchCase="columnTypes.SectionsList">
                        <mat-chip-list>
                            <mat-chip
                                color="warn"
                                selected
                                *ngFor="let sectionId of column.getValue(row)"
                                title="{{ column.Sections[sectionId].Title }}"
                            >
                                {{ column.Sections[sectionId].Title | truncate: 30 }}
                            </mat-chip>
                        </mat-chip-list>
                    </ng-container>
                    <ng-container *ngSwitchCase="columnTypes.TagsList">
                        <mat-chip-list>
                            <mat-chip
                                color="accent"
                                selected
                                *ngFor="let tagId of column.getValue(row)"
                                title="{{ column.Tags[tagId].Name }}"
                            >
                                {{ column.Tags[tagId].Name | truncate: 30 }}
                            </mat-chip>
                        </mat-chip-list>
                    </ng-container>
                    <ng-container *ngSwitchCase="columnTypes.Author">
                        <brc-user [user]="column.getValue(row)"></brc-user>
                    </ng-container>
                    <ng-container *ngSwitchCase="columnTypes.Actions">
                        <button mat-icon-button [matMenuTriggerFor]="menu">
                            <icon iconName="fa-ellipsis-v"></icon>
                        </button>
                        <mat-menu #menu="matMenu">
                            <ng-container *ngFor="let action of column.Actions">
                                <ng-container ngSwitch="{{ action.Type }}">
                                    <button
                                        mat-menu-item
                                        *ngSwitchCase="action.Types.Click"
                                        (click)="action.DoClick(row)"
                                    >
                                        <icon [icon]="action.Icon"></icon>
                                        <span>{{ action.Title }}</span>
                                    </button>
                                    <a
                                        mat-menu-item
                                        *ngSwitchCase="action.Types.ExternalLink"
                                        [href]="action.GenerateUrl(row)"
                                    >
                                        <icon [icon]="action.Icon"></icon>
                                        <span>{{ action.Title }}</span>
                                    </a>
                                </ng-container>
                            </ng-container>
                        </mat-menu>
                    </ng-container>
                    <ng-container *ngSwitchDefault="">
                        {{ column.getValue(row) }}
                    </ng-container>
                </ng-container>
            </mat-cell>
        </ng-container>

        <mat-header-row *matHeaderRowDef="columnsToDisplay"></mat-header-row>
        <mat-row *matRowDef="let row; columns: columnsToDisplay"></mat-row>
    </mat-table>

    <mat-paginator [pageSizeOptions]="[5, 10, 25, 100]"></mat-paginator>
</div>
<a class="addButton" *ngIf="addUrl" [routerLink]="addUrl" mat-fab color="primary">
    <icon iconName="fa-plus"></icon>
</a>
